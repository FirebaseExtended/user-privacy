{"version":3,"sources":["../src/platform_node/node_platform.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;GAcG;AAEH,OAAO,KAAK,IAAI,MAAM,MAAM,CAAC;AAK7B,OAAO,EAAE,mBAAmB,EAAE,MAAM,sBAAsB,CAAC;AAC3D,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,MAAM,eAAe,CAAC;AAErD,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AACnD,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAG3C;IAAA;QACW,oBAAe,GAAG,IAAI,CAAC;QAEvB,oBAAe,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC;IA+B/C,CAAC;IA7BC,qCAAc,GAAd,UAAe,YAA0B;QACvC,IAAM,MAAM,GAAG,UAAU,EAAE,CAAC;QAC5B,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,cAAc,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC,CAAC;IACnE,CAAC;IAED,oCAAa,GAAb,UAAc,WAAuB;QACnC,MAAM,CAAC,IAAI,mBAAmB,CAAC,WAAW,EAAE,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC;IACxE,CAAC;IAED,iCAAU,GAAV,UAAW,KAAY;QACrB,4EAA4E;QAC5E,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC;IAC7C,CAAC;IAED,2BAAI,GAAJ,UAAK,OAAe;QAClB,iDAAiD;QACjD,2DAA2D;QAC3D,EAAE,CAAC,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACrC,MAAM,IAAI,cAAc,CACtB,IAAI,CAAC,gBAAgB,EACrB,6BAA6B,GAAG,OAAO,CACxC,CAAC;QACJ,CAAC;QACD,MAAM,CAAC,IAAI,MAAM,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC1D,CAAC;IAED,2BAAI,GAAJ,UAAK,GAAW;QACd,MAAM,CAAC,IAAI,MAAM,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACtD,CAAC;IACH,mBAAC;AAAD,CAlCA,AAkCC,IAAA","file":"node_platform.js","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as util from 'util';\n\nimport { DatabaseId, DatabaseInfo } from '../core/database_info';\nimport { Platform } from '../platform/platform';\nimport { Connection } from '../remote/connection';\nimport { JsonProtoSerializer } from '../remote/serializer';\nimport { Code, FirestoreError } from '../util/error';\n\nimport { GrpcConnection } from './grpc_connection';\nimport { loadProtos } from './load_protos';\nimport { AnyJs } from '../util/misc';\n\nexport class NodePlatform implements Platform {\n  readonly base64Available = true;\n\n  readonly emptyByteString = new Uint8Array(0);\n\n  loadConnection(databaseInfo: DatabaseInfo): Promise<Connection> {\n    const protos = loadProtos();\n    return Promise.resolve(new GrpcConnection(protos, databaseInfo));\n  }\n\n  newSerializer(partitionId: DatabaseId): JsonProtoSerializer {\n    return new JsonProtoSerializer(partitionId, { useProto3Json: false });\n  }\n\n  formatJSON(value: AnyJs): string {\n    // util.inspect() results in much more readable output than JSON.stringify()\n    return util.inspect(value, { depth: 100 });\n  }\n\n  atob(encoded: string): string {\n    // Node actually doesn't validate base64 strings.\n    // A quick sanity check that is not a fool-proof validation\n    if (/[^-A-Za-z0-9+/=]/.test(encoded)) {\n      throw new FirestoreError(\n        Code.INVALID_ARGUMENT,\n        'Not a valid Base64 string: ' + encoded\n      );\n    }\n    return new Buffer(encoded, 'base64').toString('binary');\n  }\n\n  btoa(raw: string): string {\n    return new Buffer(raw, 'binary').toString('base64');\n  }\n}\n"]}